# ZBit永续市场做市策略文档

## 一、策略概述

ZBit永续市场做市策略（ZBit Perpetual Market Making）是一个为ZBit交易所永续合约市场提供流动性的做市策略。该策略通过在市场上同时挂出买单和卖单，赚取买卖价差（Spread）以及可能的资金费率收益，同时管理仓位风险，实现稳定收益。

### 核心理念

- **双向做市**：同时在买卖双方提供流动性，赚取买卖价差
- **多层级订单**：通过设置多层级订单，提高订单成交概率，分散风险
- **风险管理**：利用止盈止损机制，合理管理头寸风险
- **资金费率收益**：在适当时机根据资金费率方向调整头寸，获取额外收益

## 二、策略框架

### 1. 市场模型

- **市场类型**：永续合约（无到期日的衍生品）
- **交易对**：主要针对BTC-USDT等高流动性交易对
- **杠杆**：支持1-10倍杠杆，默认配置为10倍
- **持仓模式**：支持对冲模式（Hedge）和单向模式（ONEWAY）

### 2. 策略组件

1. **市场连接器**：ZbitPerpetualDerivative
2. **订单管理**：PerpetualMarketMakingStrategy
3. **风险控制**：止损、止盈、仓位限制
4. **资金费率监控**：定期检查资金费率并相应调整策略
5. **价格跟踪**：跟踪指数价格和标记价格，确保合理下单

### 3. 交互流程

```
用户配置 → 策略初始化 → 获取市场状态 → 创建订单 → 监控订单状态 → 管理仓位 → 风险控制
```

## 三、实现细节

### 1. 核心参数配置

```json
{
    "交易对": "BTC-USDT",
    "杠杆": 10,
    "持仓模式": "Hedge",
    "买单价差": 0.01,  // 1%
    "卖单价差": 0.01,  // 1%
    "订单数量": 0.01,  // BTC
    "多头止盈价差": 0.02,  // 2%
    "空头止盈价差": 0.02,  // 2%
    "止损价差": 0.05,  // 5%
    "订单层级数": 3,
    "层级价差": 0.005,  // 0.5%
    "订单刷新时间": 30,  // 秒
    "价格上限": 55000,  // USDT
    "价格下限": 45000   // USDT
}
```

### 2. 订单创建逻辑

策略将根据当前市场中间价格，在买卖两侧放置订单：

- **买单价格** = 中间价格 × (1 - 买单价差)
- **卖单价格** = 中间价格 × (1 + 卖单价差)

对于多层级订单：
- 每个层级的价差累加，例如第二层买单：中间价格 × (1 - 买单价差 - 层级价差)
- 每层的数量可以相同或递增/递减

### 3. 订单刷新机制

1. 每隔"订单刷新时间"（默认30秒）检查一次市场状态
2. 如果价格变动超过"订单刷新容差"（默认1%），取消现有订单并创建新订单
3. 如果订单部分成交，取消剩余订单并创建新订单
4. 如果订单完全成交，等待"成交订单延迟"时间后创建新订单

### 4. 仓位管理

1. **止盈机制**：
   - 多头头寸：当价格上涨至开仓价格 × (1 + 多头止盈价差) 时平仓
   - 空头头寸：当价格下跌至开仓价格 × (1 - 空头止盈价差) 时平仓

2. **止损机制**：
   - 多头头寸：当价格下跌至开仓价格 × (1 - 止损价差) 时平仓
   - 空头头寸：当价格上涨至开仓价格 × (1 + 止损价差) 时平仓

3. **资金费率调整**：
   - 正资金费率：可能减少多头头寸或增加空头头寸
   - 负资金费率：可能增加多头头寸或减少空头头寸

### 5. 订单优化

1. **Maker订单**：尽量使用限价订单，作为maker获取更低手续费
2. **深度感知**：根据订单簿深度调整订单价格，避免远离市场价格
3. **滑点控制**：特别是在止损订单执行时，控制滑点以减少损失

## 四、实时交易数据分析

### 市场状态快照 (2025-03-27)

```
中间价格: 50,000 USDT
资金费率: 0.0001 (0.01%)
资金费时间: 每8小时
账户余额: 1 BTC, 10,000 USDT
```

### 订单分析

**当前活跃订单示例：**

| 订单类型 | 价格 (USDT) | 数量 (BTC) | 层级 | 预期收益率 |
|--------|------------|-----------|------|----------|
| 买单1   | 49,500     | 0.01      | 1    | 1.0%     |
| 买单2   | 49,250     | 0.01      | 2    | 1.5%     |
| 买单3   | 49,000     | 0.01      | 3    | 2.0%     |
| 卖单1   | 50,500     | 0.01      | 1    | 1.0%     |
| 卖单2   | 50,750     | 0.01      | 2    | 1.5%     |
| 卖单3   | 51,000     | 0.01      | 3    | 2.0%     |

**成交订单分析：**

每个完整的交易周期（买入后卖出或卖出后买入）期望获得约1-2%的收益（未计算手续费）。

### 收益分析

1. **价差收益**: 
   - 每成交一轮买卖订单，获得约1%的价差收益
   - 月预期交易轮次：15-30轮
   - 月预期价差收益率：15-30%（基于初始资金）

2. **资金费收益**:
   - 根据资金费率方向持有头寸，每8小时获得一次资金费
   - 资金费率假设：平均0.01%
   - 月预期资金费收益率：0-9%（视持仓时间不同）

3. **总预期月收益率**：15-39%（未计算手续费和滑点）

### 成本分析

1. **交易手续费**:
   - Maker费率：0.02%
   - Taker费率：0.04%
   - 月预期手续费成本：总交易量的0.02-0.04%

2. **持仓成本**:
   - 逆向资金费率损失：0-9%（视资金费率方向）
   - 借贷利息（如使用杠杆）：月0.5-2%

3. **机会成本**:
   - 资金占用：持有头寸期间无法用于其他投资

### 风险控制

1. **价格风险**:
   - 使用止损订单，限制单笔亏损在5%以内
   - 设置价格上下限（45,000-55,000 USDT），避免在极端市场条件下交易

2. **仓位风险**:
   - 多层级订单分散风险，避免大量资金集中在单一价格点
   - 控制总仓位大小，避免过度杠杆

3. **流动性风险**:
   - 交易高流动性的交易对，如BTC-USDT
   - 订单大小适应市场深度，避免造成过大市场影响

4. **系统风险**:
   - 监控交易所状态和API连接
   - 设置最大重试次数和超时时间

## 五、优化方向

1. **参数优化**：
   - 基于历史数据回测不同的价差参数
   - 根据市场波动性动态调整订单层级和间距

2. **风险管理**：
   - 添加动态止损机制，如跟踪止损
   - 基于市场波动性调整仓位大小

3. **策略增强**：
   - 结合技术指标（如RSI、MACD等）进行交易决策
   - 添加趋势跟踪元素，在趋势明确时调整买卖策略

4. **执行优化**：
   - 优化订单提交和取消逻辑，减少不必要的API调用
   - 实现更智能的订单簿分析，提高订单定价效率

## 六、总结

ZBit永续市场做市策略通过在永续合约市场提供双向流动性，结合多层级订单系统和完善的风险控制机制，旨在为交易者提供一个相对稳定的收益来源。该策略适合波动性较大但具有足够流动性的加密货币市场，特别是BTC、ETH等主流币种的永续合约。

策略的核心优势在于：
1. 双向获利机会：无论市场涨跌都有获利可能
2. 风险可控：通过止损机制和多层级订单分散风险
3. 多重收益来源：同时获取价差收益和资金费收益
4. 高度可定制：根据市场条件和风险偏好调整参数

随着加密货币市场的不断发展和策略的持续优化，这一做市策略有望在各种市场环境中保持较好的表现。 